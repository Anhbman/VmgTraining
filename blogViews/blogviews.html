<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- jQuery Modal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Document</title>

    <script>
        $(document).ready(function() {
            $.getJSON('http://localhost:8080/api/blogs', function (json) {
                // console.log(json[0].category.name);
                console.log(json);
               var tr="";
               for (let i = 0; i < json.length; i++) {
                // console.log(json[i].category.name);
                tr += `<tr>
                    <td>${json[i].id}</td>
                    <td>${json[i].title}</td>
                    <td>${json[i].content}</td>
                    `;
                    for (let j = 0; j < json[i].covers.length; j++) {
                        tr += `<td><img width="50px" src='http://127.0.0.1:8080/image/${json[i].covers[j].name}'></td>`;
                    }
                    tr +=`<td>${json[i].category ? json[i].category.name : ""}</td>
                    <td><button class='edit'>Edit</button> <button class='delete' id='${json[i].id}'>Delete</button></td>
                    </tr>`;
               } 
               $('table').append($(tr));
            });
        });

        $(document).delegate('.delete', 'click', function() {
            console.log("Delete running...");
            if (confirm('Do you really want to delete record?')) {
                var id = $(this).attr('id');
                var parent = $(this).parent().parent();
                $.ajax({
                    type: "DELETE",
                    url: "http://localhost:8080/api/blogs/" + id,
                    cache: false,
                    success: function() {
                        parent.fadeOut('slow', function() {
                            $(this).remove();
                        });
                        location.reload(true);
                    },
                    error: function() {
                        $('#err').html('<span style=\'color:red; font-weight: bold; font-size: 30px;\'>Error deleting record').fadeIn().fadeOut(4000, function() {
                              $(this).remove();
                          });
                    }
                });
            }
        });
    </script>
</head>
<body>
   <div class="container">
    <h2>Blog Spring Boot</h2>
    <p><a class="btn" href="#add" rel="modal:open">Add New Blog</a></p>
    <table class="table">
        <thead>
            <tr>
            <th scope="col">#</th>
            <th scope="col">Title</th>
            <th scope="col">Content</th>
            <th scope="col">Cover</th>
            <th scope="col">Category</th>
            <!-- <th scope="col">Author</th> -->
            </tr>
        </thead>
    </table>

    <form id="add" action="#" class="add_form modal" style="display: none;">
        <h3>Add a New Blog</h3>
        <p>
            <label>Title</label>
            <input type="text" id="title" name="title">
        </p>
        <p>
            <label>Content</label>
            <input type="text" id="content" name="content">
        </p>
        <p>
            <label>Cover</label>
            <input type="file" multiple id="files" name="files">
        </p>
        <p>
            <label>Cover</label>
            <input type="file" multiple id="files" name="files">
        </p>

        <p>
            <label>Category</label>
            <select name="category" id="category">
                <option value="1">Hai</option>
                <option value="2">Hanh dong</option>
            </select>
        </p>
    </form>
   </div>
</body>
</html>